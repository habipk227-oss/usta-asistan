<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Usta Asistan | Kurumsal Ã‡Ã¶zÃ¼m</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="app-card">
        <footer style="margin-top: 30px; text-align: center; border-top: 1px solid #444; padding-top: 15px;">
    <p style="color: #888; font-size: 11px; line-height: 1.5; padding: 0 10px;">
        âš ï¸ <strong>Bilgilendirme:</strong> Bu uygulama kiÅŸisel takip amaÃ§lÄ±dÄ±r. <br>
        TÃ¼m veriler (satÄ±ÅŸlar, Ã¼rÃ¼nler, dÃ¼kkan ismi) sadece <strong>sizin cihazÄ±nÄ±zda</strong> saklanÄ±r; <br>
        hiÃ§bir veri sunucularÄ±mÄ±za gÃ¶nderilmez veya kaydedilmez. <br>
        Sorumluluk tamamen kullanÄ±cÄ±ya aittir.
    </p>
    <p style="color: #ffd700; font-size: 10px; margin-top: 10px;">Â© 2026 </p>
</footer>
        <header>
<header style="text-align: center; margin-bottom: 25px; position: relative; z-index: 10;">
<div id="avatar-alani" style="display: flex; justify-content: center; gap: 20px; margin-bottom: 15px;">
        <div style="text-align: center;">
            <img src="https://img.icons8.com/illustrations/64/farmer.png" alt="DadaÅŸcan" style="width: 65px; border: 2px solid #ffd700; border-radius: 50%; padding: 5px; background: #333;">
            <p style="color: #ffd700; font-size: 11px; margin: 5px 0; font-weight: bold;">DADAÅCAN</p>
        </div>
        <div style="text-align: center;">
            <img src="https://img.icons8.com/illustrations/64/grandmother.png" alt="Nenecan" style="width: 65px; border: 2px solid #ffd700; border-radius: 50%; padding: 5px; background: #333;">
            <p style="color: #ffd700; font-size: 11px; margin: 5px 0; font-weight: bold;">NENECAN</p>
        </div>
    </div>

    <h1 id="dukkan-adi" onclick="dukkanAdiniDegistir()" style="cursor: pointer; color: #ffd700; margin: 5px 0;">LÃœTFEN MARKET Ä°SMÄ°NÄ° YAZIN</h1>
    <p style="color: #ccc; font-size: 14px;">Siz anlatÄ±n, biz not alalÄ±m.</p>
</header>

        <div class="main-display">
            <div id="status">Sizi dinlemeye hazÄ±rÄ±m.</div>
            <div id="transcription">"..."</div>
            <div style="margin-top: 15px; border-top: 1px solid #444; padding-top: 10px;">
    <p style="color: #ffd700; font-size: 13px; margin-bottom: 5px;">ğŸ“¦ <strong>SÄ±k SatÄ±lanlar:</strong></p>
    <div id="hizli-urunler" style="display: flex; gap: 5px; flex-wrap: wrap;">
        <span onclick="document.getElementById('manuel-giris').value=' lira ekmek'" style="background: #333; padding: 5px 10px; border-radius: 15px; font-size: 12px; cursor: pointer;">+ Ekmek</span>
        <span onclick="document.getElementById('manuel-giris').value=' lira su'" style="background: #333; padding: 5px 10px; border-radius: 15px; font-size: 12px; cursor: pointer;">+ Su</span>
    </div>
</div>
        </div>

        <div class="action-area">
            <button id="mic-btn">
                <span class="icon">ğŸ™ï¸</span>
                ÅÄ°MDÄ° KONUÅUN
            </button>
            <div style="margin-top: 15px; display: flex; gap: 5px;">
    <input type="text" id="manuel-giris" placeholder="Ã–rn: 50 lira ekmek" style="flex: 1; padding: 10px; border-radius: 8px; border: 1px solid #ffd700; background: #222; color: white;">
    <button onclick="elleEkle()" style="padding: 10px; background: #ffd700; color: #1a1a2e; border: none; border-radius: 8px; font-weight: bold; cursor: pointer;">EKLE</button>
</div>
<div id="urun-yonetimi" style="margin-top: 20px; border: 1px dashed #ffd700; padding: 15px; border-radius: 12px; background: rgba(0,0,0,0.3);">
    <h4 style="color: #ffd700; margin-top: 0;">ğŸ“¦ ÃœrÃ¼n Listemi DÃ¼zenle</h4>
    <div style="display: flex; gap: 5px; margin-bottom: 10px;">
        <input type="text" id="yeni-urun-ad" placeholder="ÃœrÃ¼n adÄ± (Ã–rn: Vana)" style="flex: 1; padding: 10px; border-radius: 8px; border: 1px solid #555; background: #222; color: white;">
        <button onclick="listeyeUrunEkle()" style="background: #2ecc71; border: none; padding: 10px 15px; border-radius: 8px; color: white; cursor: pointer; font-weight: bold;">EKLE</button>
    </div>
    <div id="kayitli-urunler-etiketleri" style="display: flex; flex-wrap: wrap; gap: 10px;">
        </div>
</div>
        </div>
        <div class="records-area">
    <h3>GÃ¼nlÃ¼k KayÄ±tlar</h3>
    <div id="kasa-cerceve" style="background: rgba(46, 204, 113, 0.2); border: 1px solid #2ecc71; padding: 10px; border-radius: 10px; margin-bottom: 10px; color: #2ecc71; font-weight: bold; font-size: 18px;">
    ğŸ’° Toplam Kasa: <span id="toplam-kasa">0</span> TL
</div>
<div id="urun-raporu" style="background: rgba(255, 215, 0, 0.1); border: 1px solid #ffd700; padding: 15px; border-radius: 12px; margin: 10px 0; color: #ffd700; font-size: 14px; text-align: left;">
    ğŸ“Š <strong>ÃœrÃ¼n BazlÄ± Rapor:</strong>
    <div id="urun-listesi-detay" style="margin-top: 8px; font-weight: bold;">HenÃ¼z satÄ±ÅŸ yok...</div>
</div>
    <div style="margin: 10px 0; display: flex; gap: 10px; justify-content: center;">
    <button onclick="kayitlariSil()" style="background:#ff4444; color:white; border:none; padding:8px 15px; border-radius:8px; cursor:pointer; font-weight:bold;">ğŸ—‘ï¸ Temizle</button>
    <button onclick="disariAktar()" style="background:#2ecc71; color:white; border:none; padding:8px 15px; border-radius:8px; cursor:pointer; font-weight:bold;">ğŸ“¥ Excel/Ä°ndir</button>
</div>
    <ul id="records-list"></ul>
</div>
    </div>
    <script>
    const btn = document.querySelector('#mic-btn');
    const status = document.querySelector('#status');
    const transcription = document.querySelector('#transcription');
    const kasaGosterge = document.querySelector('#toplam-kasa');

    // Sayfa aÃ§Ä±ldÄ±ÄŸÄ±nda hafÄ±zayÄ± geri yÃ¼kle
    window.onload = () => {
        const kaydedilmisler = JSON.parse(localStorage.getItem('asistanKayitlari')) || [];
        const list = document.querySelector('#records-list');
        kaydedilmisler.forEach(kayit => {
            const newItem = document.createElement('li');
            newItem.textContent = kayit;
            newItem.style = "color:#ffd700; list-style:none; padding:8px 0; border-bottom:1px solid rgba(255,255,255,0.1); font-size:14px;";
            list.appendChild(newItem);
            raporuGoster();
        });
        kasaGosterge.textContent = localStorage.getItem('kasaToplam') || 0;
    };

    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    const recognition = new SpeechRecognition();
    recognition.lang = 'tr-TR';

    btn.onclick = () => {
        recognition.start();
        status.textContent = "Dinliyorum , buyurun...";
        btn.style.backgroundColor = "#ff4444";
    };

recognition.onresult = (event) => {
        const text = event.results[0][0].transcript.toLowerCase();
        transcription.textContent = `"${text}"`; 
        
        // --- AKILLI CIMBIZ SÄ°STEMÄ° ---
        let bulunanUrun = "diÄŸer";
// EsnafÄ±n kendi listesindeki Ã¼rÃ¼nleri tek tek kontrol et
esnafUrunleri.forEach(urun => {
    if (text.includes(urun)) {
        bulunanUrun = urun;
    }
});
        const kelimeler = text.split(" "); // CÃ¼mleyi kelimelere bÃ¶l

        // EÄŸer cÃ¼mlede sayÄ± ve "lira/tl" varsa, Ã¼rÃ¼nÃ¼ bulmaya Ã§alÄ±ÅŸ
        if(text.includes("lira") || text.includes("tl")) {
            const liraIndex = kelimeler.findIndex(k => k.includes("lira") || k.includes("tl"));
            
            // Genelde esnaf "100 lira vana" veya "vana 100 lira" der.
            // SayÄ±dan hemen Ã¶nceki veya hemen sonraki kelimeyi "Ã¼rÃ¼n" kabul et.
            if (liraIndex > 0) {
                // "100 lira vana" durumunda 'vana'yÄ± yakala
                if(kelimeler[liraIndex + 1]) {
                    bulunanUrun = kelimeler[liraIndex + 1];
                } 
                // "vana 100 lira" durumunda 'vana'yÄ± yakala
                else if (liraIndex > 1) {
                    bulunanUrun = kelimeler[liraIndex - 2]; 
                }
            }

            const sayilar = text.match(/\d+/g); 
            if(sayilar) {
                let eklenen = 0;
                sayilar.forEach(s => eklenen += parseFloat(s));
                
                // KasayÄ± GÃ¼ncelle
                let suAnkiKasa = parseFloat(localStorage.getItem('kasaToplam')) || 0;
                suAnkiKasa += eklenen;
                localStorage.setItem('kasaToplam', suAnkiKasa);
                document.querySelector('#toplam-kasa').textContent = suAnkiKasa;

                // ÃœRÃœN BAZLI HAFIZA (Dinamik: Listede olmasa da ekler!)
                let urunHafizasi = JSON.parse(localStorage.getItem('urunBazliHafiza')) || {};
                if(!urunHafizasi[bulunanUrun]) urunHafizasi[bulunanUrun] = 0;
                urunHafizasi[bulunanUrun] += eklenen;
                localStorage.setItem('urunBazliHafiza', JSON.stringify(urunHafizasi));

                raporuGoster();
                
                const cevap = `Bereket versin, ${bulunanUrun} iÃ§in ${eklenen} lira ekledim.`;
                status.textContent = cevap;
                const asistanSesi = new SpeechSynthesisUtterance(cevap);
                asistanSesi.lang = 'tr-TR';
                window.speechSynthesis.speak(asistanSesi);
            }
        }
        kaydiListeyeEkle(text);
    };

    // Raporu ekranda gÃ¼ncelleyen yardÄ±mcÄ± fonksiyon
    function raporuGoster() {
        const hafiza = JSON.parse(localStorage.getItem('urunBazliHafiza')) || {};
        let html = "";
        for (let urun in hafiza) {
            html += `<div>ğŸ”¸ ${urun.toUpperCase()}: ${hafiza[urun]} TL</div>`;
        }
        document.querySelector('#urun-listesi-detay').innerHTML = html || "HenÃ¼z satÄ±ÅŸ yok...";
    }

    recognition.onspeechend = () => { recognition.stop(); };

    function kayitlariSil() {
        if(confirm("KasayÄ± ve kayÄ±tlarÄ± sÄ±fÄ±rlayalÄ±m mÄ± ?")) {
            localStorage.clear();
            location.reload(); 
        }
    }

    function disariAktar() {
        const veriler = JSON.parse(localStorage.getItem('asistanKayitlari')) || [];
        const kasa = localStorage.getItem('kasaToplam') || 0;
        const icerik = `HABÄ°P USTA SATIÅ RAPORU\nTOPLAM KASA: ${kasa} TL\n\n` + veriler.join('\n');
        const blob = new Blob([icerik], { type: 'text/plain' });
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = 'Satis_Raporu.txt';
        link.click();
        function dukkanAdiniDegistir() {
    const yeniAd = prompt("LÃ¼tfen dÃ¼kkanÄ±nÄ±zÄ±n ismini yazÄ±n:");
    if (yeniAd) {
        localStorage.setItem('dukkanIsmi', yeniAd);
        document.getElementById('dukkan-adi').textContent = yeniAd;
    }
}
function dukkanAdiniDegistir() {
    const yeniAd = prompt("LÃ¼tfen dÃ¼kkanÄ±nÄ±zÄ±n ismini yazÄ±n:");
    if (yeniAd) {
        localStorage.setItem('dukkanIsmi', yeniAd);
        document.getElementById('dukkan-adi').textContent = yeniAd;
    }
}

// Sayfa aÃ§Ä±ldÄ±ÄŸÄ±nda ismi kontrol et
window.addEventListener('load', () => {
    const kayitliAd = localStorage.getItem('dukkanIsmi');
    if (kayitliAd) {
        document.getElementById('dukkan-adi').textContent = kayitliAd;
    }
});
// Sayfa ilk aÃ§Ä±ldÄ±ÄŸÄ±nda dÃ¼kkan ismini hafÄ±zadan geri Ã§aÄŸÄ±rÄ±r
window.addEventListener('load', () => {
    const kayitliAd = localStorage.getItem('dukkanIsmi');
    if (kayitliAd) {
        document.getElementById('dukkan-adi').textContent = kayitliAd;
    }
});
    }
    function elleEkle() {
    const input = document.getElementById('manuel-giris');
    const text = input.value.toLowerCase();
    if (text) {
        // Senin sesli komutlarda kullandÄ±ÄŸÄ±n mantÄ±ÄŸÄ±n aynÄ±sÄ±nÄ± buraya baÄŸlÄ±yoruz
        processResult(text); 
        input.value = ""; // Kutuyu temizle
    }
}
function dukkanAdiniDegistir() {
    const yeniAd = prompt("LÃ¼tfen dÃ¼kkanÄ±nÄ±zÄ±n ismini yazÄ±n:");
    if (yeniAd) {
        localStorage.setItem('dukkanIsmi', yeniAd);
        document.getElementById('dukkan-adi').textContent = yeniAd;
        alert("HayÄ±rlÄ± olsun , dÃ¼kkan ismi kaydedildi!");
    }
}
// Hem sesten hem klavyeden gelen yazÄ±yÄ± iÅŸleyen "Ana Beyin"
function veriyiIsle(text) {
    if(text.includes("lira") || text.includes("tl")) {
        const sayilar = text.match(/\d+/g);
        if(sayilar) {
            let eklenen = 0;
            sayilar.forEach(s => eklenen += parseFloat(s));
            
            // ÃœrÃ¼n yakalama mantÄ±ÄŸÄ± (Ã–nceki kodun aynÄ±sÄ± buraya gelecek)
            let bulunanUrun = "diÄŸer";
            const kelimeler = text.split(" ");
            const liraIndex = kelimeler.findIndex(k => k.includes("lira") || k.includes("tl"));
            if (liraIndex > 0 && kelimeler[liraIndex + 1]) bulunanUrun = kelimeler[liraIndex + 1];
            else if (liraIndex > 1) bulunanUrun = kelimeler[liraIndex - 2];

            // KasayÄ± ve ÃœrÃ¼n Raporunu GÃ¼ncelle
            let kasa = parseFloat(localStorage.getItem('kasaToplam')) || 0;
            localStorage.setItem('kasaToplam', kasa + eklenen);
            document.querySelector('#toplam-kasa').textContent = kasa + eklenen;

            let hafiza = JSON.parse(localStorage.getItem('urunBazliHafiza')) || {};
            hafiza[bulunanUrun] = (hafiza[bulunanUrun] || 0) + eklenen;
            localStorage.setItem('urunBazliHafiza', JSON.stringify(hafiza));

            raporuGoster();
            kaydiListeyeEkle(text);
        }
    }
}

// EKLE butonuna basÄ±nca Ã§alÄ±ÅŸacak fonksiyon
function elleEkle() {
    const input = document.getElementById('manuel-giris');
    if (input.value) {
        veriyiIsle(input.value.toLowerCase());
        input.value = ""; // Kutuyu temizle
    }
}
let esnafUrunleri = JSON.parse(localStorage.getItem('esnafUrunleri')) || ["ekmek", "su"];

function listeyeUrunEkle() {
    const input = document.getElementById('yeni-urun-ad');
    const ad = input.value.trim().toLowerCase();
    if (ad && !esnafUrunleri.includes(ad)) {
        esnafUrunleri.push(ad);
        localStorage.setItem('esnafUrunleri', JSON.stringify(esnafUrunleri));
        urunEtiketleriniCiz();
        input.value = "";
    }
}

function urunEtiketleriniCiz() {
    const div = document.getElementById('kayitli-urunler-etiketleri');
    div.innerHTML = esnafUrunleri.map(u => 
        `<span style="background: #444; color: #ffd700; padding: 6px 12px; border-radius: 20px; font-size: 14px; border: 1px solid #ffd700;">${u}</span>`
    ).join("");
}

// Manuel GiriÅŸi de buraya baÄŸlayalÄ±m
function elleEkle() {
    const input = document.getElementById('manuel-giris');
    if (input.value) {
        processResult(input.value.toLowerCase()); // Sesli komutun aynÄ±sÄ±nÄ± kullanÄ±r
        input.value = ""; 
    }
}

// Sayfa aÃ§Ä±ldÄ±ÄŸÄ±nda isimleri ve Ã¼rÃ¼nleri getir
window.addEventListener('load', () => {
    urunEtiketleriniCiz();
    const kayitliAd = localStorage.getItem('dukkanIsmi');
    if (kayitliAd) document.getElementById('dukkan-adi').textContent = kayitliAd;
});
</script>
</body>

</html>


